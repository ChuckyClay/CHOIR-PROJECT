<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memories page</title>
<link rel="stylesheet" href="style.css">
<style>
/* Your existing CSS unchanged */
#memoryDisplay {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    padding: 5px;
    width: 100%;
    margin: auto;
}
.memory-item{
    border: 1px solid #ccc;
    padding: 5px;
    border-radius: 10px;
    background: #f8f8f8;
    width: 150px;
    height: 200px;
    text-align: center;
    flex-shrink: 0; 
}
.memory-item img,
.memory-item video {
    width: 100%;
    height: 150px;
    border-radius: 8px;
    cursor: pointer;
}
#uploadmemory{
    cursor: pointer;
    background: #4CAF50;
    color: white;
    padding: 8px 12px;
    border-radius: 5px;
    font-weight: bold;
}
#btn a { text-decoration: none; color: white; }
#btn { background: #333; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
#upload { display: none; }
@media screen and (max-width: 600px){
    .memory-item { width: 100px; height: 150px; }
    .memory-item img, .memory-item video { height: 120px; }
}
</style>
</head>
<body>
<div id="header">
    <h1>ST THOMAS OF AQUINAS CHAPLAINACY CHOIR</h1>
    <h3><i>"Singing is praying twice"</i></h3>
</div>
<h2>Memories</h2>
<p>Here are our memorable moments</p>
<input type="file" id="upload" accept="image/*,video/*" multiple>
<label for="upload" id="uploadmemory">Add Memory</label><br><hr>
<div id="memoryDisplay"></div>
<button id="btn" onclick="location.href='activities.html'">Back</button>

<script>
    const upload = document.getElementById("upload");
const memoryDisplay = document.getElementById("memoryDisplay");

// Load saved memories from localStorage
let savedMemories = JSON.parse(localStorage.getItem("memories")) || [];
savedMemories.forEach(memory => displayMemory(memory));

// Handle file selection
upload.addEventListener("change", function() {
    const files = Array.from(this.files);
    if(files.length === 0) return;

    files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const memoryData = e.target.result;
            const memory = { type: file.type, data: memoryData };
            savedMemories.push(memory);
            localStorage.setItem("memories", JSON.stringify(savedMemories));
            displayMemory(memory);
        };
        reader.readAsDataURL(file);
    });

    // Reset input to allow same file selection again
    this.value = "";
});

function displayMemory(memory){
    const container = document.createElement("div");
    container.classList.add("memory-item");

    let preview;

    if(memory.type.startsWith("image/")){
        // Image preview
        preview = document.createElement("img");
        preview.src = memory.data;
    } 
    else if(memory.type.startsWith("video/")){
        // Video thumbnail preview
        const video = document.createElement("video");
        video.src = memory.data;
        video.preload = "metadata";

        preview = document.createElement("img"); // placeholder for thumbnail
        preview.style.width = "100%";
        preview.style.height = "150px";
        preview.style.objectFit = "cover";

        video.addEventListener("loadeddata", () => {
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            preview.src = canvas.toDataURL();
        });
    }

    // Open in new tab on click
    preview.addEventListener("click", () => {
        const newWindow = window.open();
        if(memory.type.startsWith("image/")){
            newWindow.document.write(`<img src="${memory.data}" style="width:100%;">`);
        } else {
            newWindow.document.write(`<video src="${memory.data}" controls autoplay style="width:100%; height:auto;"></video>`);
        }
    });

    // Delete button
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "Delete";
    deleteBtn.style.padding = "2px 4px";
    deleteBtn.style.marginBottom = "4px";
    deleteBtn.style.backgroundColor = "red";
    deleteBtn.style.color = "white";
    deleteBtn.style.border = "none";
    deleteBtn.style.borderRadius = "5px";

    deleteBtn.addEventListener("click", () => {
        const idx = savedMemories.indexOf(memory);
        if(idx > -1){
            savedMemories.splice(idx, 1);
            localStorage.setItem("memories", JSON.stringify(savedMemories));
            container.remove();
        }
    });

    container.appendChild(deleteBtn);
    container.appendChild(preview);
    memoryDisplay.appendChild(container);
}
</script>
</body>
</html>