<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memories Page</title>
<link rel="stylesheet" href="style.css">
<style>
#memoryDisplay {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    padding: 10px;
}

.media-item {
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 5px;
    width: 140px;
    background: white;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
}

.media-item img{
    width: 100%;
    height: 130px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
}
.media-item video {
    width: 100%;
    height: 110px;
    object-fit: cover;
    border-radius: 8px;
    cursor: pointer;
}

.delete-btn {
    background: red;
    border: none;
    border-radius: 10px;
    padding: 10px;
}
.open-btn {
    background: rgb(45, 250, 37);
    border: none;
    border-radius: 10px;
    padding: 10px;
}

#uploadmemory {
    display: inline-block;
    margin-top: 10px;
    background: #4CAF50;
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}
#upload { display: none; }

@media screen and (max-width: 600px) {
    .media-item {
        width: 100px;
    }
    .media-item img, .media-item video {
        height: 80px;
    }
}
</style>
</head>
<body>
<div id="header">
<h1>ST THOMAS OF AQUINAS CHAPLAINCY CHOIR</h1>
<h3><i>"Singing is praying twice"</i></h3>
</div>
<h2>Memories</h2>
<p>Here are our memorable moments</p>

<input type="file" id="upload" accept="image/*,video/*" multiple>
<label for="upload" id="uploadmemory">Add Memory</label>

<hr>

<div id="memoryDisplay"></div>

<button id="btn" onclick="location.href='activities.html'">Back</button>

<script>
const upload = document.getElementById("upload");
const memoryDisplay = document.getElementById("memoryDisplay");

upload.addEventListener("change", function() {
    const files = Array.from(this.files);
    files.forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const mediaDiv = document.createElement("div");
            mediaDiv.classList.add("media-item");

            if (file.type.startsWith("image/")) {
                mediaDiv.innerHTML = `
                    <img src="${e.target.result}" alt="choir photo">
                    <button class="delete-btn">Delete</button>
                `;
            } else if (file.type.startsWith("video/")) {
                mediaDiv.innerHTML = `
                    <video src="${e.target.result}" preload="metadata"></video>
                    <button class="delete-btn">Delete</button>
                    <button class="open-btn">Open</button>
                `;
            }

            memoryDisplay.appendChild(mediaDiv);
        };
        reader.readAsDataURL(file);
    });
    this.value = "";
});

// Handle delete & open buttons
memoryDisplay.addEventListener("click", function(e) {
    const parent = e.target.closest(".media-item");
    const media = parent?.querySelector("img, video");

    if (e.target.classList.contains("delete-btn")) {
        parent.remove();
    } 
    else if (e.target.classList.contains("open-btn") && media) {
        const newWindow = window.open();
        newWindow.document.write(`
            <video src="${media.src}" controls autoplay style="width:100%; height:auto; background:black;"></video>
        `);
    }
    else if (media && media.tagName === "IMG") {
        // âœ… Fixed: Show image in new tab properly
        const newWindow = window.open();
        newWindow.document.write(`
            <html>
                <head><title>View Image</title></head>
                <body style="margin:0; background:black; display:flex; justify-content:center; align-items:center; height:100vh;">
                    <img src="${media.src}" style="max-width:100%; max-height:100%;">
                </body>
            </html>
        `);
    }
});
</script>

</body>
</html>
